name: ðŸ—ï¸ IaC Management | Stop/Start Resources

on:
  workflow_dispatch:
    inputs:
      action:
        description: 'Infrastructure Action'
        required: true
        type: choice
        options:
          - stop-all
          - start-all
          - stop-database
          - start-database
          - stop-container-app
          - start-container-app
          - destroy-redis
          - recreate-redis
        default: 'stop-all'
      confirm_destructive:
        description: 'Confirm destructive actions (destroy-redis, recreate-redis)'
        required: false
        type: boolean
        default: false

env:
  # Infrastructure configuration
  RESOURCE_GROUP: 'tc-cloudgames-dev-rg'
  CONTAINER_APP_NAME: 'tc-cloudgames-dev-api-app'
  POSTGRES_SERVER_NAME: 'tc-cloudgames-dev-db'
  REDIS_CACHE_NAME: 'tc-cloudgames-dev-redis'
  
  # Terraform Cloud configuration
  TF_API_TOKEN: ${{ secrets.TF_API_TOKEN }}
  TF_CLOUD_ORGANIZATION: ${{ secrets.TF_CLOUD_ORGANIZATION }}
  TF_WORKSPACE: ${{ secrets.TF_WORKSPACE }}
  
  # Azure credentials
  CREDENTIALS: ${{ secrets.MAIN_AZURE_CREDENTIALS }}

jobs:
  # Job 1: Stop/Start Azure Resources via CLI
  manage-azure-resources:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    if: |
      contains(fromJSON('["stop-all", "start-all", "stop-database", "start-database", "stop-container-app", "start-container-app"]'), github.event.inputs.action)
    steps:
      - name: ðŸ” Azure Login
        uses: azure/login@v2
        with:
          creds: ${{ env.CREDENTIALS }}

      - name: ðŸ›‘ Stop Database Server
        if: contains(fromJSON('["stop-all", "stop-database"]'), github.event.inputs.action)
        run: |
          echo "ðŸ›‘ Stopping PostgreSQL Flexible Server..."
          
          # Get the actual server name (it includes a random suffix)
          SERVER_NAME=$(az postgres flexible-server list \
            --resource-group "$RESOURCE_GROUP" \
            --query "[?contains(name, 'tc-cloudgames-dev-db')].name" \
            --output tsv)
          
          if [ -n "$SERVER_NAME" ]; then
            echo "Found server: $SERVER_NAME"
            
            # Check current status
            CURRENT_STATUS=$(az postgres flexible-server show \
              --name "$SERVER_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "state" \
              --output tsv)
            
            echo "Current status: $CURRENT_STATUS"
            
            if [ "$CURRENT_STATUS" == "Ready" ]; then
              az postgres flexible-server stop \
                --name "$SERVER_NAME" \
                --resource-group "$RESOURCE_GROUP"
              echo "âœ… Database server stopped successfully"
            elif [ "$CURRENT_STATUS" == "Stopped" ]; then
              echo "â„¹ï¸ Database server is already stopped"
            else
              echo "âš ï¸ Database server is in state: $CURRENT_STATUS - cannot stop"
            fi
          else
            echo "âŒ Database server not found"
            exit 1
          fi

      - name: ðŸš€ Start Database Server
        if: contains(fromJSON('["start-all", "start-database"]'), github.event.inputs.action)
        run: |
          echo "ðŸš€ Starting PostgreSQL Flexible Server..."
          
          # Get the actual server name (it includes a random suffix)
          SERVER_NAME=$(az postgres flexible-server list \
            --resource-group "$RESOURCE_GROUP" \
            --query "[?contains(name, 'tc-cloudgames-dev-db')].name" \
            --output tsv)
          
          if [ -n "$SERVER_NAME" ]; then
            echo "Found server: $SERVER_NAME"
            
            # Check current status
            CURRENT_STATUS=$(az postgres flexible-server show \
              --name "$SERVER_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "state" \
              --output tsv)
            
            echo "Current status: $CURRENT_STATUS"
            
            if [ "$CURRENT_STATUS" == "Stopped" ]; then
              az postgres flexible-server start \
                --name "$SERVER_NAME" \
                --resource-group "$RESOURCE_GROUP"
              echo "âœ… Database server started successfully"
            elif [ "$CURRENT_STATUS" == "Ready" ]; then
              echo "â„¹ï¸ Database server is already running"
            else
              echo "âš ï¸ Database server is in state: $CURRENT_STATUS - cannot start"
            fi
          else
            echo "âŒ Database server not found"
            exit 1
          fi

      - name: ðŸ›‘ Stop Container App
        if: contains(fromJSON('["stop-all", "stop-container-app"]'), github.event.inputs.action)
        run: |
          echo "ðŸ›‘ Stopping Container App by setting min replicas to 0..."
          
          # Get the actual container app name (it includes a random suffix if any)
          APP_NAME=$(az containerapp list \
            --resource-group "$RESOURCE_GROUP" \
            --query "[?contains(name, 'tc-cloudgames-dev-api-app')].name" \
            --output tsv)
          
          if [ -n "$APP_NAME" ]; then
            echo "Found container app: $APP_NAME"
            
            # Get current replica configuration
            CURRENT_MIN=$(az containerapp show \
              --name "$APP_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "properties.template.scale.minReplicas" \
              --output tsv)
            
            CURRENT_MAX=$(az containerapp show \
              --name "$APP_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "properties.template.scale.maxReplicas" \
              --output tsv)
            
            echo "Current configuration: min=$CURRENT_MIN, max=$CURRENT_MAX"
            
            if [ "$CURRENT_MIN" != "0" ]; then
              # Only update min replicas to 0, keep max at 10 for quick restart
              az containerapp update \
                --name "$APP_NAME" \
                --resource-group "$RESOURCE_GROUP" \
                --min-replicas 0 \
                --max-replicas 10
              echo "âœ… Container app stopped (min replicas set to 0, max remains 10)"
            else
              echo "â„¹ï¸ Container app is already stopped (min replicas = 0)"
            fi
          else
            echo "âŒ Container app not found"
            exit 1
          fi

      - name: ðŸš€ Start Container App
        if: contains(fromJSON('["start-all", "start-container-app"]'), github.event.inputs.action)
        run: |
          echo "ðŸš€ Starting Container App by setting min replicas to 1..."
          
          # Get the actual container app name
          APP_NAME=$(az containerapp list \
            --resource-group "$RESOURCE_GROUP" \
            --query "[?contains(name, 'tc-cloudgames-dev-api-app')].name" \
            --output tsv)
          
          if [ -n "$APP_NAME" ]; then
            echo "Found container app: $APP_NAME"
            
            # Get current replica configuration
            CURRENT_MIN=$(az containerapp show \
              --name "$APP_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "properties.template.scale.minReplicas" \
              --output tsv)
            
            CURRENT_MAX=$(az containerapp show \
              --name "$APP_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "properties.template.scale.maxReplicas" \
              --output tsv)
            
            echo "Current configuration: min=$CURRENT_MIN, max=$CURRENT_MAX"
            
            if [ "$CURRENT_MIN" == "0" ] || [ "$CURRENT_MIN" == "null" ]; then
              # Set min replicas to 1 to ensure the app starts, keep max at 10 for scaling
              az containerapp update \
                --name "$APP_NAME" \
                --resource-group "$RESOURCE_GROUP" \
                --min-replicas 1 \
                --max-replicas 10
              echo "âœ… Container app started (min replicas set to 1, max remains 10)"
            else
              echo "â„¹ï¸ Container app is already running (min replicas: $CURRENT_MIN)"
            fi
          else
            echo "âŒ Container app not found"
            exit 1
          fi

      - name: ðŸ“Š Resource Status Summary
        if: always()
        run: |
          echo "ðŸ“Š Current Resource Status:"
          echo "========================="
          
          # Database status
          echo "ðŸ—„ï¸ Database Status:"
          SERVER_NAME=$(az postgres flexible-server list \
            --resource-group "$RESOURCE_GROUP" \
            --query "[?contains(name, 'tc-cloudgames-dev-db')].name" \
            --output tsv)
          
          if [ -n "$SERVER_NAME" ]; then
            DB_STATUS=$(az postgres flexible-server show \
              --name "$SERVER_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "state" \
              --output tsv)
            echo "  Server: $SERVER_NAME"
            echo "  Status: $DB_STATUS"
          fi
          
          # Container app status
          echo ""
          echo "ðŸ“¦ Container App Status:"
          APP_NAME=$(az containerapp list \
            --resource-group "$RESOURCE_GROUP" \
            --query "[?contains(name, 'tc-cloudgames-dev-api-app')].name" \
            --output tsv)
          
          if [ -n "$APP_NAME" ]; then
            MIN_REPLICAS=$(az containerapp show \
              --name "$APP_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "properties.template.scale.minReplicas" \
              --output tsv)
            
            MAX_REPLICAS=$(az containerapp show \
              --name "$APP_NAME" \
              --resource-group "$RESOURCE_GROUP" \
              --query "properties.template.scale.maxReplicas" \
              --output tsv)
            
            echo "  App: $APP_NAME"
            echo "  Scale Configuration: min=$MIN_REPLICAS, max=$MAX_REPLICAS"
            
            if [ "$MIN_REPLICAS" == "0" ]; then
              echo "  Status: ðŸ›‘ Stopped (min replicas = 0)"
            else
              echo "  Status: ðŸš€ Active (min replicas = $MIN_REPLICAS)"
            fi
          fi

  # Job 2: Manage Redis Cache via Terraform Cloud
  manage-redis-terraform:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    if: |
      contains(fromJSON('["destroy-redis", "recreate-redis"]'), github.event.inputs.action)
    steps:
      - name: âš ï¸ Validate Destructive Action Confirmation
        if: github.event.inputs.confirm_destructive != 'true'
        run: |
          echo "âŒ Destructive action requires confirmation!"
          echo "Please check 'Confirm destructive actions' checkbox to proceed."
          echo ""
          echo "âš ï¸  WARNING: This action will:"
          if [ "${{ github.event.inputs.action }}" == "destroy-redis" ]; then
            echo "  â€¢ Permanently destroy the Redis cache"
            echo "  â€¢ All cached data will be lost"
            echo "  â€¢ Applications will lose cache functionality"
          elif [ "${{ github.event.inputs.action }}" == "recreate-redis" ]; then
            echo "  â€¢ Destroy and recreate the Redis cache"
            echo "  â€¢ All cached data will be lost"
            echo "  â€¢ Cache will be empty after recreation"
          fi
          exit 1

      - name: ðŸ—‘ï¸ Destroy Redis Cache via Terraform Cloud
        if: github.event.inputs.action == 'destroy-redis'
        run: |
          echo "ðŸ—‘ï¸ Destroying Redis cache via Terraform Cloud..."
          
          # Get workspace ID
          echo "Getting workspace information..."
          WORKSPACE_ID=$(curl -s \
            -H "Authorization: Bearer $TF_API_TOKEN" \
            -H "Content-Type: application/vnd.api+json" \
            "https://app.terraform.io/api/v2/organizations/$TF_CLOUD_ORGANIZATION/workspaces/$TF_WORKSPACE" \
            | jq -r '.data.id')
          
          if [ "$WORKSPACE_ID" == "null" ] || [ -z "$WORKSPACE_ID" ]; then
            echo "âŒ Failed to get workspace ID"
            echo "Please verify TF_CLOUD_ORGANIZATION and TF_WORKSPACE secrets"
            exit 1
          fi
          
          echo "Workspace ID: $WORKSPACE_ID"
          
          # Create a targeted destroy plan for Redis
          echo "Creating targeted destroy run..."
          DESTROY_RUN_ID=$(curl -s \
            -X POST \
            -H "Authorization: Bearer $TF_API_TOKEN" \
            -H "Content-Type: application/vnd.api+json" \
            -d "{
              \"data\": {
                \"type\": \"runs\",
                \"attributes\": {
                  \"message\": \"Destroy Redis cache - triggered from GitHub Actions by ${{ github.actor }}\",
                  \"is-destroy\": true,
                  \"target-addrs\": [\"azurerm_redis_cache.redis_cache\"]
                },
                \"relationships\": {
                  \"workspace\": {
                    \"data\": {
                      \"type\": \"workspaces\",
                      \"id\": \"$WORKSPACE_ID\"
                    }
                  }
                }
              }
            }" \
            "https://app.terraform.io/api/v2/runs" \
            | jq -r '.data.id')
          
          if [ "$DESTROY_RUN_ID" == "null" ] || [ -z "$DESTROY_RUN_ID" ]; then
            echo "âŒ Failed to create destroy run"
            exit 1
          fi
          
          echo "âœ… Terraform destroy run created: $DESTROY_RUN_ID"
          echo "ðŸ”— Monitor progress: https://app.terraform.io/app/$TF_CLOUD_ORGANIZATION/workspaces/$TF_WORKSPACE/runs/$DESTROY_RUN_ID"
          
          # Wait for plan to complete
          echo "â³ Waiting for destroy plan to complete..."
          for i in {1..30}; do
            RUN_STATUS=$(curl -s \
              -H "Authorization: Bearer $TF_API_TOKEN" \
              "https://app.terraform.io/api/v2/runs/$DESTROY_RUN_ID" \
              | jq -r '.data.attributes.status')
            
            echo "Plan status ($i/30): $RUN_STATUS"
            
            if [ "$RUN_STATUS" == "planned" ]; then
              echo "âœ… Destroy plan completed successfully"
              echo "âš ï¸  Manual approval may be required in Terraform Cloud"
              break
            elif [ "$RUN_STATUS" == "applied" ]; then
              echo "âœ… Destroy completed successfully"
              break
            elif [ "$RUN_STATUS" == "errored" ] || [ "$RUN_STATUS" == "canceled" ]; then
              echo "âŒ Destroy plan failed with status: $RUN_STATUS"
              exit 1
            fi
            
            sleep 10
          done
          
          echo "ðŸ’° Estimated monthly savings: ~$15-25 (Redis Standard C1)"

      - name: ðŸ”„ Recreate Redis Cache via Terraform Cloud
        if: github.event.inputs.action == 'recreate-redis'
        run: |
          echo "ðŸ”„ Recreating Redis cache via Terraform Cloud..."
          
          # Get workspace ID
          echo "Getting workspace information..."
          WORKSPACE_ID=$(curl -s \
            -H "Authorization: Bearer $TF_API_TOKEN" \
            -H "Content-Type: application/vnd.api+json" \
            "https://app.terraform.io/api/v2/organizations/$TF_CLOUD_ORGANIZATION/workspaces/$TF_WORKSPACE" \
            | jq -r '.data.id')
          
          if [ "$WORKSPACE_ID" == "null" ] || [ -z "$WORKSPACE_ID" ]; then
            echo "âŒ Failed to get workspace ID"
            exit 1
          fi
          
          # Step 1: Destroy Redis
          echo "Step 1: Destroying existing Redis cache..."
          DESTROY_RUN_ID=$(curl -s \
            -X POST \
            -H "Authorization: Bearer $TF_API_TOKEN" \
            -H "Content-Type: application/vnd.api+json" \
            -d "{
              \"data\": {
                \"type\": \"runs\",
                \"attributes\": {
                  \"message\": \"Destroy Redis for recreation - triggered from GitHub Actions by ${{ github.actor }}\",
                  \"is-destroy\": true,
                  \"target-addrs\": [\"azurerm_redis_cache.redis_cache\"]
                },
                \"relationships\": {
                  \"workspace\": {
                    \"data\": {
                      \"type\": \"workspaces\",
                      \"id\": \"$WORKSPACE_ID\"
                    }
                  }
                }
              }
            }" \
            "https://app.terraform.io/api/v2/runs" \
            | jq -r '.data.id')
          
          echo "Destroy run created: $DESTROY_RUN_ID"
          
          # Wait for destroy to complete
          echo "â³ Waiting for destroy to complete..."
          for i in {1..60}; do
            RUN_STATUS=$(curl -s \
              -H "Authorization: Bearer $TF_API_TOKEN" \
              "https://app.terraform.io/api/v2/runs/$DESTROY_RUN_ID" \
              | jq -r '.data.attributes.status')
            
            echo "Destroy status ($i/60): $RUN_STATUS"
            
            if [ "$RUN_STATUS" == "applied" ]; then
              echo "âœ… Destroy completed successfully"
              break
            elif [ "$RUN_STATUS" == "errored" ] || [ "$RUN_STATUS" == "canceled" ]; then
              echo "âŒ Destroy failed with status: $RUN_STATUS"
              exit 1
            fi
            
            sleep 15
          done
          
          # Step 2: Create Redis
          echo "Step 2: Creating new Redis cache..."
          sleep 30  # Wait a bit before recreating
          
          CREATE_RUN_ID=$(curl -s \
            -X POST \
            -H "Authorization: Bearer $TF_API_TOKEN" \
            -H "Content-Type: application/vnd.api+json" \
            -d "{
              \"data\": {
                \"type\": \"runs\",
                \"attributes\": {
                  \"message\": \"Recreate Redis cache - triggered from GitHub Actions by ${{ github.actor }}\",
                  \"target-addrs\": [\"azurerm_redis_cache.redis_cache\"]
                },
                \"relationships\": {
                  \"workspace\": {
                    \"data\": {
                      \"type\": \"workspaces\",
                      \"id\": \"$WORKSPACE_ID\"
                    }
                  }
                }
              }
            }" \
            "https://app.terraform.io/api/v2/runs" \
            | jq -r '.data.id')
          
          echo "âœ… Redis recreation run created: $CREATE_RUN_ID"
          echo "ðŸ”— Monitor progress: https://app.terraform.io/app/$TF_CLOUD_ORGANIZATION/workspaces/$TF_WORKSPACE/runs/$CREATE_RUN_ID"

      - name: ðŸ“Š Terraform Operation Summary
        if: always()
        run: |
          echo "ðŸ“Š Terraform Operation Summary:"
          echo "==============================="
          echo "Action performed: ${{ github.event.inputs.action }}"
          echo "Workspace: $TF_WORKSPACE"
          echo "Organization: $TF_CLOUD_ORGANIZATION"
          echo "Triggered by: ${{ github.actor }}"
          echo "Timestamp: $(date -u)"
          echo ""
          echo "ðŸ”— View workspace: https://app.terraform.io/app/$TF_CLOUD_ORGANIZATION/workspaces/$TF_WORKSPACE"

  # Job 3: Cost Estimation and Summary
  cost-summary:
    runs-on: ubuntu-latest
    needs: [manage-azure-resources, manage-redis-terraform]
    if: always()
    steps:
      - name: ðŸ’° Cost Impact Summary
        run: |
          echo "ðŸ’° Cost Impact Summary"
          echo "====================="
          
          ACTION="${{ github.event.inputs.action }}"
          
          case "$ACTION" in
            "stop-all")
              echo "ðŸ›‘ Resources Stopped:"
              echo "  â€¢ PostgreSQL Flexible Server: ~$20-50/month savings"
              echo "  â€¢ Container App: ~$10-30/month savings" 
              echo "  â€¢ Total estimated savings: ~$30-80/month"
              echo ""
              echo "ðŸ’¡ Benefits:"
              echo "  â€¢ Immediate cost reduction"
              echo "  â€¢ Resources can be restarted quickly"
              echo "  â€¢ Data is preserved"
              ;;
            "start-all")
              echo "ðŸš€ Resources Started:"
              echo "  â€¢ PostgreSQL Flexible Server: ~$20-50/month cost resumed"
              echo "  â€¢ Container App: ~$10-30/month cost resumed"
              echo "  â€¢ Total estimated cost resumed: ~$30-80/month"
              echo ""
              echo "âœ… Services:"
              echo "  â€¢ Database ready for connections"
              echo "  â€¢ API ready to handle requests"
              echo "  â€¢ Full application functionality restored"
              ;;
            "stop-database")
              echo "ðŸ›‘ Database Server Stopped:"
              echo "  â€¢ PostgreSQL Flexible Server: ~$20-50/month savings"
              echo "  â€¢ âš ï¸  Application will lose database connectivity"
              ;;
            "start-database")
              echo "ðŸš€ Database Server Started:"
              echo "  â€¢ PostgreSQL Flexible Server: ~$20-50/month cost resumed"
              echo "  â€¢ âœ… Database ready for connections"
              ;;
            "stop-container-app")
              echo "ðŸ›‘ Container App Stopped:"
              echo "  â€¢ Container App: ~$10-30/month savings"
              echo "  â€¢ âš ï¸  API endpoints will be unavailable"
              ;;
            "start-container-app")
              echo "ðŸš€ Container App Started:"
              echo "  â€¢ Container App: ~$10-30/month cost resumed"
              echo "  â€¢ âœ… API ready to handle requests"
              ;;
            "destroy-redis")
              echo "ðŸ—‘ï¸ Redis Cache Destroyed:"
              echo "  â€¢ Redis Standard C1: ~$15-25/month savings"
              echo "  â€¢ âš ï¸  Data permanently lost - ensure backups if needed"
              echo "  â€¢ âš ï¸  Applications will lose cache functionality"
              ;;
            "recreate-redis")
              echo "ðŸ”„ Redis Cache Recreated:"
              echo "  â€¢ Redis Standard C1: ~$15-25/month cost resumed"
              echo "  â€¢ ðŸ—‘ï¸ Previous data lost - cache will be empty"
              echo "  â€¢ âœ… Fresh cache instance available"
              ;;
            *)
              echo "Individual resource action performed: $ACTION"
              ;;
          esac
          
          echo ""
          echo "ðŸ“Š Resource Management Tips:"
          echo "  â€¢ Use 'stop-all' during non-business hours for maximum savings"
          echo "  â€¢ Database stop/start may take 2-5 minutes"
          echo "  â€¢ Container apps scale instantly"
          echo "  â€¢ Redis recreation takes 10-15 minutes"
          echo "  â€¢ Always confirm destructive actions"
          echo ""
          echo "â° Recommended Schedule:"
          echo "  â€¢ Weekdays 6 PM: stop-all"
          echo "  â€¢ Weekdays 8 AM: start-all" 
          echo "  â€¢ Weekends: keep stopped"

      - name: ðŸ“§ Action Completion Summary
        run: |
          echo "## ðŸ—ï¸ IaC Management Action Completed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Detail | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| **Action** | \`${{ github.event.inputs.action }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| **Triggered by** | \`${{ github.actor }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| **Timestamp** | \`$(date -u)\` |" >> $GITHUB_STEP_SUMMARY
          echo "| **Confirmation** | \`${{ github.event.inputs.confirm_destructive }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          if [[ "${{ github.event.inputs.action }}" == *"redis"* ]]; then
            echo "### ðŸ”— Terraform Cloud" >> $GITHUB_STEP_SUMMARY
            echo "Monitor progress in your [Terraform Cloud workspace](https://app.terraform.io/app/$TF_CLOUD_ORGANIZATION/workspaces/$TF_WORKSPACE)" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "### ðŸ“‹ Next Steps" >> $GITHUB_STEP_SUMMARY
          case "${{ github.event.inputs.action }}" in
            "stop-all"|"stop-database"|"stop-container-app")
              echo "- Monitor cost savings in Azure Cost Management" >> $GITHUB_STEP_SUMMARY
              echo "- Use corresponding 'start' action to resume services" >> $GITHUB_STEP_SUMMARY
              ;;
            "start-all"|"start-database"|"start-container-app")
              echo "- Verify application functionality" >> $GITHUB_STEP_SUMMARY
              echo "- Check health endpoints" >> $GITHUB_STEP_SUMMARY
              ;;
            "destroy-redis")
              echo "- Verify applications handle missing cache gracefully" >> $GITHUB_STEP_SUMMARY
              echo "- Monitor application performance without cache" >> $GITHUB_STEP_SUMMARY
              ;;
            "recreate-redis")
              echo "- Update application connection strings if needed" >> $GITHUB_STEP_SUMMARY
              echo "- Warm up cache with frequently accessed data" >> $GITHUB_STEP_SUMMARY
              ;;
          esac
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **IaC Management operation completed successfully!**" >> $GITHUB_STEP_SUMMARY
